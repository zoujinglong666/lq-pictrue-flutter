# æœç´¢åŠŸèƒ½ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

å°†åŸæœ¬éœ€è¦è·³è½¬é¡µé¢çš„æœç´¢åŠŸèƒ½ä¼˜åŒ–ä¸ºæ›´æµç•…çš„äº¤äº’ä½“éªŒ,å¹¶å¯¹æ¥äº†çœŸå®çš„åç«¯APIæ¥å£ã€‚

## âœ¨ ä¸»è¦æ”¹è¿›

### 1. **é¦–é¡µæœç´¢ä¼˜åŒ–** (`home_page.dart`)

#### æ–°å¢åŠŸèƒ½:
- âœ… **ç›´æ¥æœç´¢** - åœ¨é¦–é¡µæœç´¢æ¡†ç›´æ¥è¾“å…¥å¹¶æœç´¢,æ— éœ€è·³è½¬
- âœ… **å®æ—¶ç­›é€‰** - æ”¯æŒåˆ†ç±»ç­›é€‰å’Œæ’åºé€‰æ‹©
- âœ… **æ¸…ç©ºæœç´¢** - ä¸€é”®æ¸…ç©ºæœç´¢æ¡ä»¶å’Œç»“æœ
- âœ… **ç­›é€‰é¢æ¿** - å¯æŠ˜å çš„ç­›é€‰å™¨,ä¸å ç”¨è¿‡å¤šç©ºé—´
- âœ… **APIå¯¹æ¥** - å®Œæ•´å¯¹æ¥ `PictureApi.getList` æ¥å£

#### æ–°å¢çŠ¶æ€å˜é‡:
```dart
final TextEditingController _searchController = TextEditingController();
final FocusNode _searchFocusNode = FocusNode();

// åŠ¨ç”»æ§åˆ¶å™¨
late AnimationController _filterAnimationController;
late Animation<double> _filterAnimation;

String _searchKeyword = '';
String _selectedCategory = 'å…¨éƒ¨';
String _selectedSort = 'æœ€æ–°';
List<String> _selectedTags = []; // å¤šé€‰æ ‡ç­¾
bool _showFilters = false;
```

#### æ ¸å¿ƒæ–¹æ³•:
- `_buildRequestParams(int page)` - æ„å»ºAPIè¯·æ±‚å‚æ•°(åŒ…å«æœç´¢ã€åˆ†ç±»ã€æ’åºã€æ ‡ç­¾)
- `_performSearch(String keyword)` - æ‰§è¡Œæœç´¢
- `_applyFilters()` - åº”ç”¨ç­›é€‰æ¡ä»¶
- `_resetFilters()` - é‡ç½®ç­›é€‰æ¡ä»¶åˆ°é»˜è®¤å€¼
- `_clearSearch()` - æ¸…ç©ºæœç´¢å’Œç­›é€‰

#### ç­›é€‰é€‰é¡¹:
- **åˆ†ç±»**: å…¨éƒ¨ã€æ¨¡æ¿ã€ç”µå•†ã€è¡¨æƒ…åŒ…ã€ç´ æã€æµ·æŠ¥ (ä¸åç«¯å®šä¹‰ä¸€è‡´)
- **æ’åº**: æœ€æ–°(æŒ‰åˆ›å»ºæ—¶é—´)ã€çƒ­é—¨(æŒ‰ç‚¹èµæ•°)
- **æ ‡ç­¾**: çƒ­é—¨ã€æç¬‘ã€ç”Ÿæ´»ã€é«˜æ¸…ã€è‰ºæœ¯ã€æ ¡å›­ã€èƒŒæ™¯ã€ç®€å†ã€åˆ›æ„ (æ”¯æŒå¤šé€‰)
- **é‡ç½®æŒ‰é’®**: ä¸€é”®é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶åˆ°é»˜è®¤å€¼

### 2. **æœç´¢é¡µé¢é‡æ„** (`search_page.dart`)

#### åŠŸèƒ½è°ƒæ•´:
- âœ… **ä¿ç•™ä¸ºé«˜çº§æœç´¢å…¥å£** - ç”¨æˆ·ä»å¯ç‚¹å‡»å¯¼èˆªè¿›å…¥
- âœ… **çœŸå®APIå¯¹æ¥** - ä½¿ç”¨ `PictureApi.getList` è·å–æœç´¢ç»“æœ
- âœ… **ç€‘å¸ƒæµå±•ç¤º** - æœç´¢ç»“æœä»¥ç€‘å¸ƒæµå½¢å¼å±•ç¤º
- âœ… **åˆ†é¡µåŠ è½½** - æ”¯æŒä¸Šæ‹‰åŠ è½½æ›´å¤š
- âœ… **è‡ªåŠ¨èšç„¦** - æ‰“å¼€é¡µé¢è‡ªåŠ¨èšç„¦æœç´¢æ¡†
- âœ… **æœç´¢å»ºè®®** - æœªæœç´¢æ—¶æ˜¾ç¤ºçƒ­é—¨æ ‡ç­¾å’Œæœç´¢æç¤º

#### æ ¸å¿ƒåŠŸèƒ½:
```dart
// æ‰§è¡Œæœç´¢(æ”¯æŒåˆ†é¡µ)
Future<void> _performSearch({bool loadMore = false})

// é‡ç½®ç­›é€‰æ¡ä»¶
void _resetFilters()

// æ„å»ºæœç´¢ç»“æœå±•ç¤º
Widget _buildSearchResults()

// æ˜¾ç¤ºæœç´¢å»ºè®®
Widget _buildSearchSuggestions()
```

#### æœç´¢å‚æ•°:
```dart
{
  'current': page,
  'pageSize': 20,
  'searchText': keyword,         // æœç´¢å…³é”®è¯
  'sortField': 'createTime/likeCount',  // æ’åºå­—æ®µ
  'sortOrder': 'descend',
  'category': category,          // åˆ†ç±»ç­›é€‰(å¯é€‰)
}
```

## ğŸ¯ äº¤äº’æµç¨‹

### é¦–é¡µæœç´¢æµç¨‹:
1. ç”¨æˆ·åœ¨é¦–é¡µæœç´¢æ¡†è¾“å…¥å…³é”®è¯
2. æŒ‰å›è½¦æˆ–æœç´¢æŒ‰é’®æ‰§è¡Œæœç´¢
3. é¡µé¢ç›´æ¥åˆ·æ–°æ˜¾ç¤ºæœç´¢ç»“æœ
4. å¯ç‚¹å‡»ç­›é€‰æŒ‰é’®è°ƒæ•´åˆ†ç±»å’Œæ’åº
5. ç‚¹å‡»æ¸…é™¤æŒ‰é’®æ¢å¤é»˜è®¤åˆ—è¡¨

### é«˜çº§æœç´¢æµç¨‹:
1. ç”¨æˆ·ä»åº•éƒ¨å¯¼èˆªæˆ–å…¶ä»–å…¥å£è¿›å…¥æœç´¢é¡µ
2. è‡ªåŠ¨èšç„¦æœç´¢æ¡†,å¯æŸ¥çœ‹çƒ­é—¨æ ‡ç­¾
3. è¾“å…¥å…³é”®è¯å¹¶æœç´¢
4. ç€‘å¸ƒæµå±•ç¤ºç»“æœ,æ”¯æŒåŠ è½½æ›´å¤š
5. å¯ä½¿ç”¨ç­›é€‰å™¨ç²¾ç¡®æœç´¢

## ğŸ“Š APIæ¥å£è¯´æ˜

### ä½¿ç”¨æ¥å£:
```dart
PictureApi.getList(Map<String, dynamic> params)
```

### è¯·æ±‚å‚æ•°:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| current | int | æ˜¯ | å½“å‰é¡µç  |
| pageSize | int | æ˜¯ | æ¯é¡µæ•°é‡ |
| searchText | String | å¦ | æœç´¢å…³é”®è¯ |
| category | String | å¦ | åˆ†ç±»ç­›é€‰ |
| tags | List<String> | å¦ | æ ‡ç­¾ç­›é€‰(å¤šé€‰) |
| sortField | String | å¦ | æ’åºå­—æ®µ(createTime/likeCount) |
| sortOrder | String | å¦ | æ’åºæ–¹å¼(descend/ascend) |

### è¿”å›æ•°æ®:
```dart
Page<PictureVO> {
  records: List<PictureVO>,  // å›¾ç‰‡åˆ—è¡¨
  current: int,              // å½“å‰é¡µ
  total: int,                // æ€»è®°å½•æ•°
  pages: int                 // æ€»é¡µæ•°
}
```

## ğŸ¨ UI/UXæ”¹è¿›

### é¦–é¡µæœç´¢æ¡†:
- å¯ç›´æ¥è¾“å…¥æ–‡å­—
- æœ‰æ¸…é™¤æŒ‰é’®(è¾“å…¥å†…å®¹æ—¶æ˜¾ç¤º)
- æœ‰ç­›é€‰æŒ‰é’®(åˆ‡æ¢ç­›é€‰é¢æ¿)
- æ”¯æŒå›è½¦æœç´¢

### ç­›é€‰é¢æ¿:
- å¯æŠ˜å è®¾è®¡,èŠ‚çœç©ºé—´
- **çµåŠ¨å¼¹å‡ºåŠ¨ç”»**: 
  - SlideTransition: ä»ç­›é€‰æŒ‰é’®(å³ä¸Šè§’)å‘ä¸‹æ»‘å…¥
  - ScaleTransition: ä» 0.85 ç¼©æ”¾åˆ° 1.0, å¸¦å›å¼¹æ•ˆæœ
  - FadeTransition: é€æ˜åº¦æ¸å˜
- **åŠ¨ç”»æ—¶é•¿**: 350ms
- **ç¼“åŠ¨æ›²çº¿**: 
  - easeOutBack(å›å¼¹) - ç¼©æ”¾åŠ¨ç”»
  - easeOutCubic(å¹³æ»‘) - æ»‘åŠ¨å’Œæ·¡å…¥
- èŠ¯ç‰‡å¼é€‰æ‹©å™¨,äº¤äº’å‹å¥½
- é€‰ä¸­çŠ¶æ€æœ‰æ˜æ˜¾è§†è§‰åé¦ˆ
- æ ‡ç­¾æ”¯æŒå¤šé€‰,å°å°ºå¯¸åœ†è§’èŠ¯ç‰‡æ ·å¼
- å·¦ä¾§"é‡ç½®"æŒ‰é’®,å³ä¾§"åº”ç”¨ç­›é€‰"æŒ‰é’®
- é‡ç½®æŒ‰é’®å¸¦åˆ·æ–°å›¾æ ‡,æ›´ç›´è§‚
- å¢å¼ºé˜´å½±æ•ˆæœ,æ›´æœ‰å±‚æ¬¡æ„Ÿ

### æœç´¢ç»“æœ:
- ä¸é¦–é¡µåˆ—è¡¨æ ·å¼ä¸€è‡´
- æ”¯æŒä¸‹æ‹‰åˆ·æ–°
- æ”¯æŒæ»šåŠ¨åŠ è½½æ›´å¤š
- ç©ºçŠ¶æ€æç¤ºå‹å¥½

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

1. **çŠ¶æ€ç®¡ç†** - ä½¿ç”¨ `setState` ç®¡ç†æœç´¢çŠ¶æ€
2. **é”®ç›˜æ§åˆ¶** - ä½¿ç”¨ `FocusNode` æ§åˆ¶é”®ç›˜æ˜¾ç¤º/éšè—
3. **æ»šåŠ¨ç›‘å¬** - å®ç°æ— é™æ»šåŠ¨åŠ è½½
4. **å‚æ•°æ„å»º** - åŠ¨æ€æ„å»ºAPIè¯·æ±‚å‚æ•°
5. **é”™è¯¯å¤„ç†** - æœç´¢å¤±è´¥æ—¶æ˜¾ç¤ºæç¤º

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### é¦–é¡µæœç´¢:
```dart
// ç”¨æˆ·è¾“å…¥"é£æ™¯"å¹¶å›è½¦
_performSearch("é£æ™¯")

// APIè°ƒç”¨:
PictureApi.getList({
  "current": 1,
  "pageSize": 10,
  "searchText": "é£æ™¯",
  "sortField": "createTime",
  "sortOrder": "descend",
})
```

### ç­›é€‰æœç´¢:
```dart
// ç”¨æˆ·é€‰æ‹©"ç”µå•†"åˆ†ç±» + "çƒ­é—¨"æ’åº
_selectedCategory = "ç”µå•†"
_selectedSort = "çƒ­é—¨"
_applyFilters()

// APIè°ƒç”¨:
PictureApi.getList({
  "current": 1,
  "pageSize": 10,
  "category": "ç”µå•†",
  "sortField": "likeCount",
  "sortOrder": "descend",
})
```

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **æœç´¢å†å²** - ä¿å­˜ç”¨æˆ·æœç´¢è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
2. **æœç´¢è”æƒ³** - å®ç°è¾“å…¥æ—¶çš„å…³é”®è¯è”æƒ³
3. **é«˜äº®å…³é”®è¯** - åœ¨æœç´¢ç»“æœä¸­é«˜äº®æ˜¾ç¤ºæœç´¢è¯
4. **è¯­éŸ³æœç´¢** - é›†æˆè¯­éŸ³è¾“å…¥åŠŸèƒ½
5. **æœç´¢ç»Ÿè®¡** - è®°å½•çƒ­é—¨æœç´¢è¯
6. **æ ‡ç­¾æœç´¢** - æ”¯æŒæŒ‰æ ‡ç­¾ç­›é€‰(tagså­—æ®µ)
7. **é«˜çº§ç­›é€‰** - æ”¯æŒå°ºå¯¸ã€æ ¼å¼ç­‰æ›´å¤šç»´åº¦ç­›é€‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿åç«¯APIæ”¯æŒ `searchText` å‚æ•°
2. åˆ†ç±»å€¼éœ€ä¸åç«¯å®šä¹‰ä¿æŒä¸€è‡´
3. æœç´¢å…³é”®è¯ä¼šè‡ªåŠ¨ trim å»é™¤é¦–å°¾ç©ºæ ¼
4. æ¸…ç©ºæœç´¢ä¼šé‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶
5. é¡µé¢é”€æ¯æ—¶ä¼šè‡ªåŠ¨æ¸…ç†èµ„æº(Controllerã€FocusNodeç­‰)

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v1.3 (æœ€æ–°)
- âœ… ç­›é€‰é¢æ¿çµåŠ¨å¼¹å‡ºåŠ¨ç”»
- âœ… ä»ç­›é€‰æŒ‰é’®ä½ç½®å‘ä¸‹æ»‘å‡º
- âœ… ç»„åˆ SlideTransition + ScaleTransition + FadeTransition
- âœ… å›å¼¹ç¼©æ”¾æ•ˆæœ(Curves.easeOutBack)
- âœ… å¢å¼ºé˜´å½±æ•ˆæœ,æå‡å±‚æ¬¡æ„Ÿ

### v1.2
- âœ… æ·»åŠ æ ‡ç­¾(tags)ç­›é€‰åŠŸèƒ½
- âœ… æ”¯æŒå¤šæ ‡ç­¾åŒæ—¶é€‰æ‹©
- âœ… ç­›é€‰é¢æ¿å±•å¼€/æ”¶èµ·åŠ¨ç”»
- âœ… SizeTransition + FadeTransition ç»„åˆåŠ¨ç”»
- âœ… æ ‡ç­¾æ ·å¼æ›´ç²¾è‡´(å°å°ºå¯¸èŠ¯ç‰‡)

### v1.1
- âœ… æ·»åŠ ç­›é€‰æ¡ä»¶é‡ç½®æŒ‰é’®
- âœ… ä¼˜åŒ–æŒ‰é’®å¸ƒå±€(é‡ç½® + åº”ç”¨ç­›é€‰)
- âœ… ç»Ÿä¸€åˆ†ç±»æ•°æ®ä¸åç«¯å®šä¹‰
- âœ… é‡ç½®æŒ‰é’®æ·»åŠ åˆ·æ–°å›¾æ ‡

### v1.0
- âœ… é¦–é¡µé›†æˆå³æ—¶æœç´¢åŠŸèƒ½
- âœ… å®ç°æ— è·³è½¬å¼æœç´¢äº¤äº’
- âœ… æ·»åŠ åˆ†ç±»ä¸æ’åºè”åˆç­›é€‰
- âœ… æœç´¢é¡µé¢ä½œä¸ºé«˜çº§å…¥å£ä¿ç•™
- âœ… å¯¹æ¥åç«¯åˆ†é¡µæœç´¢æ¥å£

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å¤§å¹…æå‡äº†æœç´¢åŠŸèƒ½çš„ç”¨æˆ·ä½“éªŒ:
- âœ… æ— éœ€è·³è½¬é¡µé¢,äº¤äº’æ›´æµç•…
- âœ… å¯¹æ¥çœŸå®API,æ•°æ®çœŸå®å¯ç”¨
- âœ… æ”¯æŒå¤šç»´åº¦ç­›é€‰(åˆ†ç±»+æ’åº+æ ‡ç­¾)
- âœ… æ ‡ç­¾æ”¯æŒå¤šé€‰,ç»„åˆç­›é€‰æ›´çµæ´»
- âœ… ç­›é€‰é¢æ¿åŠ¨ç”»æµç•…,ä½“éªŒä¼˜é›…
- âœ… ä¿ç•™é«˜çº§æœç´¢å…¥å£,åŠŸèƒ½å®Œæ•´
- âœ… ä»£ç ç»“æ„æ¸…æ™°,æ˜“äºç»´æŠ¤

### åŠ¨ç”»æ•ˆæœè¯¦æƒ…:
```dart
// åŠ¨ç”»æ§åˆ¶å™¨åˆå§‹åŒ– (350ms)
_filterAnimationController = AnimationController(
  duration: const Duration(milliseconds: 350),
  vsync: this,
);

// 1. é€æ˜åº¦åŠ¨ç”» - å¹³æ»‘æ·¡å…¥
_filterAnimation = CurvedAnimation(
  parent: _filterAnimationController,
  curve: Curves.easeOutCubic,
);

// 2. ç¼©æ”¾åŠ¨ç”» - å›å¼¹æ•ˆæœ (0.85 â†’ 1.0)
_filterScaleAnimation = Tween<double>(
  begin: 0.85,
  end: 1.0,
).animate(CurvedAnimation(
  parent: _filterAnimationController,
  curve: Curves.easeOutBack, // å›å¼¹æ›²çº¿
));

// 3. æ»‘åŠ¨åŠ¨ç”» - ä»å³ä¸Šè§’æ»‘å…¥
_filterSlideAnimation = Tween<Offset>(
  begin: const Offset(0.3, -0.3), // èµ·å§‹ä½ç½®(å³ä¸Šæ–¹)
  end: Offset.zero,                // ç»“æŸä½ç½®(æ­£å¸¸)
).animate(CurvedAnimation(
  parent: _filterAnimationController,
  curve: Curves.easeOutCubic,
));

// ç»„åˆåŠ¨ç”» - çµåŠ¨å¼¹å‡º
SlideTransition(
  position: _filterSlideAnimation,
  child: ScaleTransition(
    scale: _filterScaleAnimation,
    alignment: Alignment.topRight, // ä»å³ä¸Šè§’ç¼©æ”¾
    child: FadeTransition(
      opacity: _filterAnimation,
      child: Container(
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(16),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.08),
              blurRadius: 16,
              offset: const Offset(0, 4),
              spreadRadius: 2,
            ),
          ],
        ),
        child: // ç­›é€‰å™¨å†…å®¹...
      ),
    ),
  ),
)
```

### ç­›é€‰ç¤ºä¾‹:
```dart
// ç»„åˆç­›é€‰: æœç´¢ + åˆ†ç±» + æ’åº + æ ‡ç­¾
PictureApi.getList({
  "searchText": "äººåƒ",
  "category": "æ¨¡æ¿",
  "sortField": "likeCount",
  "tags": ["é«˜æ¸…", "è‰ºæœ¯"],
})
```
